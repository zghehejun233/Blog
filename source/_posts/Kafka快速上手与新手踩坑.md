---
title: Kafka 快速上手与学习笔记
description: 一篇记录 Kafka 上手过程的文章，包括踩坑过程、经典问题和一些与其他MQ的比较。
date: 2024-02-03 16:45:30
keywords: [Kafka, MQ, 消息队列]
headimg: https://s2.loli.net/2024/02/03/HjKYGWQbXr3PTi2.png
tags:
  - 服务端
  - MQ
  - 笔记
categories: 
  - 技术
plugins:
  - indent
  - snackbar: updating
---

## 前言

### MQ介绍

消息队列（Message Queue，MQ）是消息传递中间件解决方案的一个组件，旨在支持独立的应用和服务之间的信息交换。 消息队列按发送顺序存储“消息”（由应用所创建、供其他应用使用的数据包），直到使用方应用能够处理它们为止。 这些消息安全地等待接收方应用做好准备，因此，即使网络或接收方应用出现问题，消息队列中的消息也不会丢失。

这种称为异步消息传递的模式可防止数据丢失，并使系统能够在流程或连接失败时继续工作。 这也使开发人员能够将流程与应用分离，确保它们的通信是独立的，而且由事件驱动，从而使架构更加可靠。

对于完全没有听说过MQ的读者，不妨设想这样一个典型的场景：

1. 你的应用有不止一个程序在协同工作，他们分布在不同的机器、网络上，甚至采用了不同语言开发。
2. 你的应用需要延迟处理一些数据。
3. 你希望一些数据能够被妥善得到处理，也就是保证它一定会被处理而不会发生丢失。
4. 你希望在程序之间实现类似广播的机制进行通信。

在诸如此类的场景中，我们需要在应用程序之外实现各种五花八门的通信。通常来讲，这样的场景可以总结为“一些程序在处理（不管是立刻还是稍后，一次还是多次）另外一些程序产生的数据，而且常常需要按照顺序处理”，在这里要处理的数据就可以视作“消息”，而用于存放这些消息、按照先来后到的顺序消费的容器就是一个“队列”，所谓“消息队列”也不过是这样一个在“队列”里装“消息”的中间件。

消息队列的应用场景十分广泛，例如；

- 数据的异步通信，开发人员不需要考虑网络协议和远程调用的问题。
- 系统业务解耦，分布系统之间，不必直接强依赖。
- 消息数据入队出队，流量削峰。
- 跨平台跨语种的消息通讯。
- 可做缓冲等。

### MQ的特性和设计

### 几种常见的MQ

目前来看，Kafka、RabbitMQ、RocketMQ 可以算是最主流的三个选择，而且三者基本没有太大的交叉。大致可以这样划分：

- RocketMQ 定位于非日志的可靠消息传输（日志场景也OK）。作为阿里开源的项目，RocketMQ 在订单处理等业务性强的领域凭借其特性（支持事务消息、顺序消息、消息回溯等）显得格外使用，但是从开源社区来看其氛围属实一般。
- Kafka 是LinkedIn开源的分布式发布-订阅消息系统，目前归属于Apache顶级项目。Kafka主要特点是基于Pull的模式来处理消息消费，追求高吞吐量，一开始的目的就是用于日志收集和传输。0.8版本开始支持复制，不支持事务，对消息的重复、丢失、错误没有严格要求，适合产生大量数据的互联网服务的数据收集业务。可以说，Kafka 是 MQ 中间件不折不扣的标准代表。
- RabbitMQ 是使用 Erlang 开发的开源消息队列系统，基于AMQP协议来实现。相比 Kafka，RabbitMQ 更加注重消息的可靠性，支持事务、持久化、集群等特性，适合对消息的可靠性要求较高的场景。

| 特性                   | RabbitMQ   | RocketMQ            | Kafka               |
| ---------------------- | ---------- | ------------------- | ------------------- |
| 单机吞吐量             | 1w         | 10w                 | 10w                 |
| 开发语言               | Erlang     | Java                | Java & Scala        |
| 消息延迟               | 微妙       | 毫秒                | 毫秒                |
| 消息丢失               | 可能性很低 | 参数优化后可以0丢失 | 参数优化后可以0丢失 |
| 消费模式               | 推拉       | 推拉                | 拉取                |
| 主题数量对吞吐量的影响 | 没啥影响   | 几百上千个会有影响  | 几十上百个会有影响  |
| 可用性                 | 主从       | 主从                | 分布式              |

## 参考资料

- [什么是消息队列 - IBM](https://www.ibm.com/cn-zh/topics/message-queues)
- [消息队列详解：ActiveMQ、RocketMQ、RabbitMQ、Kafka - Dingsky](https://www.dingsky.com/article/20.html)
